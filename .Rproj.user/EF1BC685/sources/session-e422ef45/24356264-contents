---
title: "Assign10"
author: "Julia"
date: "2023-08-16"
output: html_document
---

Pizza sales

```{r}
library(tidyverse)
library(readxl)
```

The Waialua Pizza Company is a medium-sized chain of pizzerias located at beaches all over the South Pacific. The company thinks that the income levels of the nearby community and the presence or absence of competition might be major factors in determining sales.

The data in the file PizzaSales Data includes daily sales performance data (DS, in U.S. dollars) for some of its stores, along with the weekly per capita income (PCI, in U.S. dollars) in the neighborhood where each store is located, as well as of whether each store has one ore more competing pizzerias that are located within half mile (COMPETITION).
```{r}
Pizza_data <- read_excel("./data/PizzaSales_Data.xlsx", sheet = 2)
View(Pizza_data)
# DS: Daily sales
# PCI: Per Capita Income
```
# Measuring the additive effect of competition by constructing a dummy variable. 

In this part of the assignment, we construct and use a dummy variable to estimate impact of local competition on daily sales.

• Construct a new dummy variable COMP, which will indicate whether a store faces local competition or not: set COMP = 1 for each store with COMPETITION = Yes, and set COMP = 0 for each store with COMPETITION = No.
```{r}
Pizza_data <- Pizza_data %>% mutate(COMP = if_else(COMPETITION =="Yes", 1, 0))
```

• Run the simple linear regression DS ∼ COMP, with daily sales (DS) as the dependent variable, and the dummy variable for competition (COMP) as the only independent variabl
```{r}
ds_comp <- lm(DS ~ COMP, data = Pizza_data)
```

1. (1 point) Based on the regression model DS ∼ COMP, provide an estimate for the expected daily sales for a store which faces local competition.

```{r}
COMP <- 1
Exp_DS <- 1105.43-455.35* COMP
Exp_DS
```

2. (1 point) Based on the DS ∼ COMP regression model, how confident can one be that the expected daily sales of a store that faces no competition are higher than the expected daily sales of a store that faces local competition?

```{r}
# H0: DS_COMP > DS_NOCOMP
# H1: DS_COMP < DS_NOCOMP

# t_stats
## (mean_a - mean_b) / sqrt(var_a/n_a + var_b/n_b)
n_comp <- subset(Pizza_data, COMP == 1) %>% count() %>% as.numeric()
n_nocomp <- subset(Pizza_data, COMP == 0) %>% count() %>% as.numeric()

mean_comp <- subset(Pizza_data, COMP == 1) %>% .$DS %>% mean()
mean_nocomp <- subset(Pizza_data, COMP == 0) %>% .$DS %>% mean()

sd_comp <- subset(Pizza_data, COMP == 1) %>% .$DS %>% sd()
sd_nocomp <- subset(Pizza_data, COMP == 0) %>% .$DS %>% sd()

t_stat1 <- (mean_comp - mean_nocomp) / sqrt(sd_comp^2/n_comp + sd_nocomp^2/n_nocomp)
1-pnorm(abs(t_stat1), lower.tail = FALSE)
```

# Measuring the effect of per capita income and competition on daily sales.

Run the multiple linear regression model DS ∼ COMP+PCI with daily sales (DS) as the dependent variable, and the competition dummy (COMP) and the per capita income (PCI) as the two independent variables.

```{r}
ds_comp_pci <- lm(DS ~ COMP + PCI, data = Pizza_data)
ds_comp_pci
```

3. (1 point) Based on the regression model DS ∼ COMP + PCI, provide an estimate for the expected daily sales for a store in a neighborhood with weekly per capita income of $300 (PCI = 300) and in the presence of local competition.
```{r}
comp <- 1
pci <- 300

ds <- 332 - 383.41*comp + 2.49*pci
ds
```

4. (1 point) Based on the regression model DS ∼ COMP + PCI, how confident can one be that the expected daily sales of a store that faces local competition are at least $350 less than the expected daily sales of a store that faces no competition? (Hint. What is the confidence level for the COMP coefficient being less than −350?)

```{r}
# H0: mean_nocomp - mean_comp <350
# H1: mean_nocomp - mean_comp >350

summary(ds_comp_pci)

t_stat2 <- (-383.4076+ 350)/ 33.9381
1-pnorm(abs(t_stat2), lower.tail = FALSE)
```

# Using dummy variables to estimate interaction effects. 

In this part of the assignment, we introduce a slope dummy variable which is constructed by multiplying values of the per capita income variables (PCI) with the value of the competition dummy (COMP) for each data point. This new variable—which we will refer to as PCI COMP—allows to estimate the interaction effect of local competition and per capita income.

• Construct the slope dummy variable PCI COMP, by setting PCI COMP = PCI × COMP for each data point.
Note that PCI COMP = 0 when COMP = 0, and PCI COMP = PCI when COMP = 1.
```{r}
Pizza_data <- mutate(Pizza_data, PCI_COMP = PCI*COMP)
Pizza_data
```

• Run the multiple linear regression DS ∼ PCI + PCI COMP, in which daily sales (DS) is the dependent variable, and per capita income (PCI) and the newly constructed slope dummy (PCI COMP) are the two independent variables.
```{r}
ds_pci <- lm(DS ~ PCI + PCI_COMP, data = Pizza_data)
summary(ds_pci)
```
5. (1 point) Based on the regression model DS ∼ PCI + PCI COMP, provide an estimate for the expected daily sales of a store in a neighborhood with weekly per capita income of $300 (PCI = 300) and with no competition.
```{r}
pci <- 300
cpi_comp <- 0

ds <- 83.38323 + 3.28789*pci -1.27436*cpi_comp
ds
```

6. (1 point) Based on the regression model DS ∼ PCI + PCI COMP, provide an estimate for the expected daily sales of a store in a neighborhood with weekly per capita income of $300 (PCI = 300) and in the presence of local competition.
```{r}
pci <- 300
cpi_comp <- 300

ds <- 83.38323 + 3.28789*pci -1.27436*cpi_comp
ds
```

7. (1 point) Based on the regression model DS ∼ PCI + PCI COMP, what is the estimate for the expected change in daily sales due to a $100 increase of weekly per capita income in a neighborhood in which there is no competition (COMP = 0)?
```{r}
pci <- 100
cpi_comp <- 0

ds_change <- 3.28789*pci -1.27436*cpi_comp
ds_change
```

8. (0 points) Based on the regression model DS ∼ PCI + PCI COMP, what is the estimate for the expected change in daily sales due to a $100 increase of weekly per capita income in a neighborhood in which there is local competition (COMP = 1)?


9. (1 point) Compare the regression model DS ∼ PCI + PCI COMP (dependent variable: DS; independent variables: PCI and PCI COMP) with the regression model DS ∼ COMP + PCI (dependent variable: DS; independent variables: PCI and COMP). Select all of the correct statements from below. (Note. Keep in mind that incorrect selections will be graded with negative points.)

 The standard error of regression in the model DS ∼ PCI+PCI COMP **(94.28)** is larger than the standard error of regression in the model DS ∼ COMP + PCI **(117.5)** 

> The standard error of regression in the model DS ∼ PCI+PCI COMP is smaller than the standard error of regression in the model DS ∼ COMP + PCI

 The slope coefficient for PCI COMP is not significant at a 95% confidence level

> The slope coefficient for PCI COMP is significant at 95% confidence level

 The slope coefficient COMP is not significant at 95% confidence level

> The slope coefficient COMP is significant at 95% confidence level

 Something is wrong with the model DS ∼ PCI + PCI COMP since the p-value of the intercept is too high

 Something is wrong since both models DS ∼ PCI + PCI COMP and DS ∼ COMP + PCI have one independent variable with negative t-stat value

```{r}
summary(ds_comp_pci)
summary(ds_pci)
```

10. (0 points) Run a regression model with daily sales (DS) as the dependent variable, and with the competition dummy (COMP), the weekly per capita income (PCI), and the slope dummy (PCI COMP) as the three independent variables. Based on this regression model, which of the following are estimates of the line DSc = a + mPCI for stores facing no competition (COMP = 0) and for stores facing local competition (COMP = 1).

11. (1 point) Run a regression model with daily sales (DS) as the dependent variable, and with the competition dummy (COMP), the weekly per capita income (PCI), and the slope dummy (PCI COMP) as the three independent variables. How confident can one be that the coefficient of the dummy variable COMP is not zero?
```{r}
summary(lm(DS ~ COMP + PCI + PCI_COMP, data = Pizza_data))

# H0: C = 0
# H1: C != 0

t_stat3 <- -11.1001/78.6879
1-pnorm(abs(t_stat3))
```

# The stratified approach. 

We now stratify the data and build separate regression models for daily sales of stores (0) facing no competition, and (1) facing local competition. To do so, you need to split the data and separately treat observations that correspond to neighborhoods with no competition and observations from neighborhoods with competition.

Next, run two separate regressions, one for each of the two segments:

(0) Simple linear regression model DS ∼ PCI for stores that face no competition with DS as the dependent variable and PCI as the independent variable;
```{r}
pizza_nocomp_data <- subset(Pizza_data, COMP == 0)
model0 <- lm(DS ~ PCI, data = pizza_nocomp_data)
model0
```

(1) Simple linear regression model DS ∼ PCI for stores that face competition with DS as the dependent variable and PCI as the independent variable
```{r}
model1 <- lm(DS ~ PCI, data = pizza_comp_data)
model1
```

12. (1 point) Consider the regression model DS 0 ∼ PCI 0 for the stores facing no competition, and the regression model DS 1 ∼ PCI 1 for the stores facing local competition. Which of the following are the estimates of the respective regression lines?

 The regression line estimate for the stores facing no competition is DSd0 = 79.601+2.025PCI 0; the regression line estimate for the stores facing local competition is DSd1 = 90.701+3.267PCI 1

 The regression line estimate for the stores facing no competition is DSd0 = 79.601+3.267PCI 0; the regression line estimate for the stores facing local competition is DSd1 = 90.701+2.025PCI 1

 The regression line estimate for the stores facing no competition is DSd0 = 90.701+2.025PCI 0, the regression line estimate for the stores facing local competition is DSd1 = 79.601+3.267PCI 1

> The regression line estimate for the stores facing no competition is DSd0 = 90.701+3.267PCI 0; the regression line estimate for the stores facing local competition is DSd1 = 79.601+2.025PCI 















